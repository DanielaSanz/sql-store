IF object_id('P_OBTAIN_BILL') is not null
	DROP PROC P_OBTAIN_BILL;
GO

CREATE PROC P_OBTAIN_BILL
@ID_BILL INT
AS
BEGIN
	SELECT B.ID 'NUMERO DE FACTURA'
	, C.NAME +' '+ C.SURNAME 'CLIENTE'
	, TC.DESCRIPTION 'TIPO DE CLIENTE'
	, SUM(BD.AMOUNT) 'CANT TOTAL'
	, SUM(BD.PRICE * BD.AMOUNT) 'TOTAL BRUTO'
	, SUM(BD.PRICE * BD.AMOUNT) * TC.IVA 'TOTAL NETO'
	FROM BILL_DETAILS BD
	JOIN BILLS B ON B.ID = BD.ID_BILL
	JOIN CUSTOMERS C ON C.ID = B.ID_CUSTOMER
	JOIN TYPES_CLIENT TC ON TC.ID = C.ID_TYPE_CLIENT
	WHERE BD.ID_BILL = @ID_BILL
	GROUP BY B.ID, C.NAME+' '+ C.SURNAME, TC.DESCRIPTION, TC.IVA
END
GO